<div align="center">

# ğŸ”® Watchwyrd

### *Your viewing fate, revealed*

[![License: MIT](https://img.shields.io/badge/License-MIT-purple.svg)](https://opensource.org/licenses/MIT)
[![Node.js](https://img.shields.io/badge/Node.js-20+-green.svg)](https://nodejs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0+-blue.svg)](https://www.typescriptlang.org/)
[![Status](https://img.shields.io/badge/Status-Experimental-orange.svg)](#%EF%B8%8F-disclaimer)

<img src="docs/watchwyrd_logo_transparent.png" alt="Watchwyrd Logo" width="200">

**An AI-powered Stremio addon that uses Google Gemini or Perplexity AI to divine your perfect movie and TV series recommendations.**

[Origin](#-origin--philosophy) â€¢ [Features](#-features) â€¢ [Installation](#-installation) â€¢ [Self-Hosting](#-self-hosting) â€¢ [Disclaimer](#%EF%B8%8F-disclaimer)

---

</div>

## âš ï¸ Disclaimer

> **ğŸ§ª EXPERIMENTAL SOFTWARE - USE AT YOUR OWN RISK**
>
> This project is an **experimental proof-of-concept** and is provided "AS IS" without warranty of any kind, express or implied.
>
> **By using this software, you acknowledge and agree that:**
>
> - This is **not production-ready software** and may contain bugs, errors, or security vulnerabilities
> - The author(s) are **not responsible** for any damages, costs, data loss, or other issues arising from use of this software
> - **You are solely responsible** for any API costs incurred (Gemini, Perplexity, or other services)
> - **You are solely responsible** for compliance with the terms of service of any third-party APIs you use
> - The software may **break, change, or be discontinued** at any time without notice
> - **No support is guaranteed** - this is a personal project, not a commercial product
>
> **Use of AI-generated recommendations:**
> - Recommendations are generated by AI and may be inaccurate, inappropriate, or biased
> - The author(s) do not endorse or take responsibility for any content recommended by the AI
> - Always use your own judgment when selecting content to watch

---

## ğŸŒŸ Origin & Philosophy

> *From Old English/Norse "wyrd" (fate, destiny) â€” an AI oracle that divines your perfect cinematic destiny.*

### The Vision

Watchwyrd was born from a simple frustration: **existing recommendation algorithms don't understand context**. They know what you watched, but not *when* or *why* you want to watch something.

The core insight is that the **same person wants different content** at different times:
- A lazy Sunday morning calls for light comedies
- A Friday night demands action-packed thrillers
- A rainy winter evening needs cozy, atmospheric films
- The holiday season deserves festive classics

### Design Philosophy

This project follows strict **engineering principles**:

| Principle | Implementation |
|-----------|----------------|
| **Static Configuration** | No runtime user interaction - all preferences set at install time |
| **Cost Efficiency** | Batch-level API calls, aggressive caching, minimal external dependencies |
| **Gemini-First** | Prefer AI's built-in knowledge over external APIs |
| **Privacy by Design** | Your API key, your data, stateless architecture |
| **Transparency** | Every recommendation can be explained |

### What This Is NOT

| Non-Goal | Reason |
|----------|--------|
| Real-time mood detection | Violates static configuration constraint |
| Watch history integration | Stremio doesn't expose this to addons |
| Social recommendations | No access to friends' data |
| Stream provision | This addon recommends, not streams |
| Per-item API calls | Economically unsustainable |

### The Name

**Watchwyrd** combines:
- **Watch** â€” the act of viewing content
- **Wyrd** â€” the Old English/Norse concept of fate and destiny

The brand sits at the intersection of **mysticism** and **cutting-edge AI technology** â€” intelligent, personalized, and a little bit magical.

---

## âœ¨ Features

ğŸ§  **AI-Powered Recommendations**
- Choose your AI provider: **Google Gemini** or **Perplexity AI**
- Leverages state-of-the-art language models for intelligent content discovery
- Understands your preferences, not just your history

ğŸŒ… **Context-Aware**
- Knows it's a lazy Sunday morning vs. a Friday night
- Seasonal awareness (cozy winter films, summer blockbusters)
- Holiday-themed suggestions when appropriate
- **ğŸŒ¤ï¸ Weather-based mood matching** - Set your city for local weather integration

ğŸ¯ **Deeply Personalized**
- Genre preferences with fine-grained weighting
- Novelty vs. classics slider
- Hidden gems vs. mainstream control
- Age rating filters

ğŸ“º **10 Curated Catalogs**

| Movies | Series |
|--------|--------|
| ğŸ¬ Watchwyrd: Movies (main) | ğŸ“º Watchwyrd: Series (main) |
| ğŸ’ Hidden Gems | ğŸ’ Hidden Gems |
| ğŸ¬ All-Time Greats | ğŸ“º Binge-Worthy |
| ğŸ›‹ï¸ Comfort Picks | â˜• Easy Watching |
| ğŸ² Surprise Me | ğŸ² Surprise Me |

ğŸ”’ **Privacy-First**
- Uses YOUR API key (you control the costs)
- No account required
- Stateless design - we don't track you

ğŸ§™ **Step-by-Step Setup Wizard**
- Clean 5-step configuration flow
- Real-time API key validation
- Auto-detected timezone & country
- Preview recommendations before installing

ğŸ†• **Fresh Content**
- Perplexity's web search discovers new releases
- Stays current beyond model knowledge cutoff

## ğŸš€ Installation

### Quick Start (Hosted)

1. Get an API key:
   - **Google Gemini**: [aistudio.google.com/apikey](https://aistudio.google.com/apikey) (free tier available!)
   - **Perplexity AI**: [perplexity.ai/settings/api](https://www.perplexity.ai/settings/api)
2. Visit your hosted configuration page (see [Self-Hosting](#-self-hosting) below)
3. Select your AI provider, enter your API key and preferences
4. Click "Install in Stremio"

### Manual Installation

If you prefer, copy this URL into Stremio's "Install from URL":

```
https://your-watchwyrd-instance.com/YOUR_CONFIG/manifest.json
```

## âš™ï¸ Configuration

### AI Providers

| Provider | Pros | Cons |
|----------|------|------|
| ğŸŒŸ **Google Gemini** | Free tier, multiple models, fast | Rate limits on free tier |
| ğŸ” **Perplexity AI** | Built-in web search, real-time data | Paid only, per-request cost |

### Quick Setup Profiles

| Profile | Best For |
|---------|----------|
| ğŸ¬ **Casual** | Mainstream entertainment, popular picks |
| ğŸ¥ **Cinephile** | Critics' favorites, hidden gems, all eras |
| ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **Family** | Kid-friendly content, PG-13 max |
| ğŸ“º **Binge Watcher** | Series-focused, high binge scores |
| ğŸ” **Discovery** | Off-the-beaten-path recommendations |

### Advanced Options

- **Genre Weights**: Fine-tune your preferences (1-5 scale per genre)
- **Novelty Bias**: Slide between timeless classics â†” new releases
- **Popularity Bias**: Slide between hidden gems â†” mainstream hits
- **Content Rating**: Set your maximum (G to NC-17)
- **Time Context**: Enable/disable time-of-day awareness
- **Seasonal Themes**: Toggle holiday/seasonal recommendations

## ğŸ–¥ï¸ Self-Hosting

Watchwyrd is fully open-source and easy to self-host!

### Using Docker (Recommended)

```bash
# Clone the repository
git clone https://github.com/fpMiguel/watchwyrd.git
cd watchwyrd

# Start with Docker Compose
docker-compose up -d

# Access at http://localhost:7000
```

### Using Node.js

```bash
# Clone and install
git clone https://github.com/fpMiguel/watchwyrd.git
cd watchwyrd
npm install

# Configure environment
cp .env.example .env
# Edit .env with your settings

# Build and run
npm run build
npm start
```

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | `7000` | Server port |
| `HOST` | `0.0.0.0` | Bind address |
| `BASE_URL` | `http://localhost:7000` | Public URL |
| `CACHE_BACKEND` | `memory` | `memory` or `redis` |
| `REDIS_URL` | - | Redis connection URL |
| `CACHE_TTL` | `21600` | Cache duration (seconds) |
| `LOG_LEVEL` | `info` | `debug`, `info`, `warn`, `error` |

### Deployment Options

<details>
<summary><b>ğŸ”· Deploy to Railway</b></summary>

[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/watchwyrd)

1. Click the button above
2. Set `BASE_URL` to your Railway URL
3. Done!

</details>

<details>
<summary><b>â–² Deploy to Vercel</b></summary>

```bash
npm i -g vercel
vercel
```

Set `BASE_URL` in environment variables.

</details>

<details>
<summary><b>ğŸ³ Deploy with Docker</b></summary>

```bash
docker run -d \
  --name watchwyrd \
  -p 7000:7000 \
  -e BASE_URL=https://your-domain.com \
  ghcr.io/fpMiguel/watchwyrd:latest
```

</details>

## ğŸ“Š How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Watchwyrd Architecture                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ Stremio â”‚â”€â”€â”€â–¶â”‚  Watchwyrd   â”‚â”€â”€â”€â–¶â”‚  Gemini API     â”‚          â”‚
â”‚   â”‚   App   â”‚â—€â”€â”€â”€â”‚    Server    â”‚â—€â”€â”€â”€â”‚  (Your Key)     â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   OR            â”‚          â”‚
â”‚                         â”‚            â”‚  Perplexity AI  â”‚          â”‚
â”‚                         â–¼            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                  â”‚    Cache     â”‚    â”‚    Cinemeta     â”‚          â”‚
â”‚                  â”‚  (6hr TTL)   â”‚â—€â”€â”€â–¶â”‚  (IMDb lookup)  â”‚          â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **You configure** your preferences at install time (choose AI provider)
2. **Stremio requests** catalog from Watchwyrd
3. **We check cache** - if fresh, return immediately
4. **If cache miss**, we call your chosen AI with your preferences + context
5. **AI returns** titles and years (AI-powered reasoning)
6. **Cinemeta validates** each title â†’ correct IMDb IDs and posters
7. **We cache & return** accurate, personalized recommendations

### Why Cinemeta?

Rather than asking the AI to generate IMDb IDs (which can be hallucinated),
Watchwyrd asks the AI for **titles and years**, then validates each against
Stremio's Cinemeta metadata service. This ensures:

- âœ… **100% accurate IMDb IDs** - no hallucinated or wrong IDs
- âœ… **Correct posters and metadata** - directly from Cinemeta
- âœ… **Movies stay movies, series stay series** - content type validation

### Cost Efficiency

- **Batch requests**: One AI call generates 20+ recommendations
- **Smart caching**: 6-hour TTL, temporal bucketing
- **Cinemeta cache**: 24-hour TTL to minimize API calls
- **Estimated cost**: 
  - **Gemini 3 Flash**: $0.30-$3.60/user/month (free tier available)
  - **Perplexity Sonar Pro**: ~$5/1000 requests (check current pricing)

## ğŸ› ï¸ Development

```bash
# Install dependencies
npm install

# Start dev server with hot reload
npm run dev

# Run tests
npm test

# Run tests with coverage
npm run test:coverage

# Lint code
npm run lint

# Format code
npm run format

# Type check
npm run typecheck
```

## ğŸ—ºï¸ Roadmap

### ğŸ§ª v0.0.37 (Current - Experimental)

This is an **experimental release** for testing and development purposes.

**Implemented features:**
- [x] Core recommendation engine with Gemini + Perplexity AI
- [x] Movie + Series support with 10 curated catalogs
- [x] Time/day/season/weather awareness
- [x] Genre preferences and content filters
- [x] **Step-by-step setup wizard** with real-time validation
- [x] Configurable catalog size (5-50 items)
- [x] Memory caching with 6-hour TTL
- [x] Cinemeta validation for accurate IMDb IDs
- [x] Privacy-focused logging

### ğŸ”œ v1.0.0 (Stable)
- [ ] Production hardening and security audit
- [ ] API key encryption in URLs
- [ ] Comprehensive error handling
- [ ] Performance optimization
- [ ] Documentation completion
- [ ] Pagination with smart context continuation

### ğŸ”® Future
- [ ] **Franchise navigation** - Group related movies/series together
- [ ] **Horizontal scaling** - Kubernetes/Docker Swarm support
- [ ] **Redis caching** - For high-traffic deployments
- [ ] Multi-language support
- [ ] "Similar to X" catalog

## ğŸ”’ Security & Privacy

Watchwyrd is designed with privacy and security as core principles:

### Privacy by Design

| Principle | Implementation |
|-----------|----------------|
| **No tracking** | We don't store user behavior or watch history |
| **No accounts** | Configuration is encoded in the addon URL - nothing server-side |
| **Your API key** | You control your Gemini/Perplexity costs and usage |
| **Stateless** | Server has no persistent user data |
| **Local-first** | All preferences stay on your device/URL |

### Third-Party Services

Watchwyrd connects to the following external services. **Your data is shared with these providers when you use their features:**

| Service | Purpose | Data Sent | Privacy Policy |
|---------|---------|-----------|----------------|
| **Google Gemini** | AI recommendations | Your preferences, context (time, season), genre weights | [Google AI Privacy](https://ai.google.dev/terms) |
| **Perplexity AI** | AI recommendations (with web search) | Same as Gemini + real-time search queries | [Perplexity Privacy](https://www.perplexity.ai/privacy) |
| **Open-Meteo** | Weather data (free, no API key) | City coordinates only (lat/lon) | [Open-Meteo Terms](https://open-meteo.com/en/terms) - No personal data collected |
| **Cinemeta** | IMDb metadata lookup | Movie/series titles and years | Stremio's official service |

#### What We DON'T Send to AI Providers:
- âŒ Your IP address (not forwarded)
- âŒ Your Stremio username or account info
- âŒ Your watch history
- âŒ Any personally identifiable information

#### What We DO Send to AI Providers:
- âœ… Genre preferences and weights
- âœ… Time of day, day of week, season (derived from your timezone)
- âœ… Country code (for holiday detection)
- âœ… Weather conditions (if enabled, via Open-Meteo)
- âœ… Content rating preferences
- âœ… Novelty/popularity bias settings

### Open-Meteo (Weather Service)

If you enable weather-based recommendations:
- We use [Open-Meteo](https://open-meteo.com/), a **free, open-source weather API**
- Only your selected city's **latitude and longitude** are sent
- No API key required, no personal data collected by Open-Meteo
- Weather data is fetched server-side; your IP is not exposed to Open-Meteo

### Production Logging

In production (`NODE_ENV=production`), logs are automatically sanitized:
- API keys, tokens, and credentials are **redacted**
- Long strings are truncated (may contain PII)
- Only operational data is logged (errors, timing, counts)

In development, full data is available for debugging.

### Security Best Practices

- **No secrets in code**: All sensitive config via environment variables
- **Input validation**: Zod schemas validate all user input
- **CORS configured**: Configurable origins (default: permissive for Stremio)
- **Rate limiting**: Built-in retry backoff respects Gemini limits
- **Dependency scanning**: Dependabot enabled for security updates

### Future Security Roadmap

- [ ] **API key encryption**: Encrypt keys in URLs (AES-256)
- [ ] **Request signing**: HMAC validation for tamper-proof configs
- [ ] **Audit logging**: Optional compliance logging (GDPR-ready)
- [ ] **IP anonymization**: Hash IPs in logs
- [ ] **CSP headers**: Content Security Policy for configure page
- [ ] **Rate limiting**: Per-IP and per-config rate limits

## ğŸ¤ Contributing

Contributions are welcome! Please read our [Contributing Guide](CONTRIBUTING.md) first.

```bash
# Fork, clone, and create a branch
git checkout -b feature/amazing-feature

# Make your changes, then
npm run lint
npm test

# Commit and push
git commit -m 'feat: add amazing feature'
git push origin feature/amazing-feature

# Open a Pull Request
```

## ğŸ“ License

MIT License - see [LICENSE](LICENSE) for details.

## ğŸ™ Acknowledgments

- [Stremio](https://www.stremio.com/) for the amazing platform
- [Google Gemini](https://ai.google.dev/) for the AI capabilities
- All our [contributors](https://github.com/fpMiguel/watchwyrd/graphs/contributors)

---

<div align="center">

**[â¬† Back to Top](#-watchwyrd)**

Made with ğŸ’œ and a sprinkle of âœ¨ destiny

*May your watchlist never be empty* ğŸ”®

</div>
